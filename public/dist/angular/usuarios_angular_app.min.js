var app=angular.module("hermes_app",[]);app.controller("users_ctrl",function(r,e){r.url="/api/user",r.create=function(o){e({method:"post",url:r.url,data:o}).then(function(e){r.users.push(e.data),toastr.success("Usuário salvo!"),r.newForm()},r.handleErrorResponse)},r.update=function(o){e({method:"put",url:r.url.concat("/",o.id),data:o}).then(function(e){if(toastr.success("Usuário alterado!"),r.newForm(),"undefined"!=typeof r.form.indexInCollection&&r.users[r.form.indexInCollection].id==r.form.user.id)r.users[r.form.indexInCollection]=angular.copy(r.form.user);else for(var o=0;o<r.users.length;o++)if(r.users[o].id==r.form.user.id){r.users[o]=angular.copy(r.form.user);break}return!0},r.handleErrorResponse)},r.handleErrorResponse=function(r){switch(console.log(r),r.status){case 200:toastr.info("O servidor retornou status 200, mas a resposta foi tratada como erro! Informe o desenvolvedor!");break;case 403:toastr.error("Parece que você não tem autorização para fazer isso!");break;case 422:for(var e in r.data)toastr.error(r.data[e]);break;case 500:toastr.error("Ops! Ocorreu um erro interno no servidor!");break;default:toastr.error("Um erro desconhecido ocorreu! Atualize a página!","Erro ".concat(r.status))}},r.loadUsers=function(){e({method:"get",url:"/api/user"}).then(function(e){r.users=e.data},r.handleErrorResponse)},r.newForm=function(){r.form={function:"create",user:{name:"",email:"",password:"",password_confirm:"",habilitado:1,permissoes:{enviar_sms:!0,enviar_lote_sms:!1,manter_usuarios:!1,visualizar_envios:!1,visualizar_relatorios:!1}}}},r.init=function(){r.loadUsers(),r.newForm()},r.disableUser=function(e){e.habilitado=!1,r.update(e)},r.enableUser=function(e){e.habilitado=!0,r.update(e)},r.editUser=function(e,o){r.form.function="update",r.form.user=angular.copy(r.users[o]),r.form.indexInCollection=o},r.formSubmit=function(){"create"===r.form.function?(r.form.user.habilitado=!0,r.create(r.form.user)):"update"===r.form.function&&r.update(r.form.user)}});