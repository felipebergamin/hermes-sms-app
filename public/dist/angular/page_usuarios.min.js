$(function(){function a(a){var e=$('<tr id="'+a.id+'">'),r="";r+="<td>",r+='   <div class="btn-group">',r+='       <button type="button" class="btn btn-default"><i class="fa fa-remove"></i></button>',r+='       <button type="button" class="btn btn-default"><i class="fa fa-pencil"></i></button>',r+="   </div>",r+="</td>",r+="<td>"+a.id+"</td>",r+="<td>"+a.nome+"</td>",r+="<td>",r+='   <span class="label '+("ativo"===a.status?"label-success":"label-danger")+'">',r+="   "+a.status,r+="   </span>",r+="</td>",e.append(r),$("table.table").append(e),$("tr#"+a.id).children("td:first-child").children("div").children("button").children("i.fa-remove").parent().bind("click",desativarUsuario),$("tr#"+a.id).children("td:first-child").children("div").children("button").children("i.fa-remove").parent().bind("click",btnEditarUsuClick)}var e=!1;resetarFormUsuario=function(){console.log("limpando form"),$('form input[name="operacao"]').val("insere"),$('form button[type="submit"]').html("Inserir"),$("#form-usuarios").parent().children(":first-child").children().html("Add novo usuário..."),$('#form-usuarios input[name="id"]').remove()},$('form button[type="reset"]').click(resetarFormUsuario),atualizaDadosNaTabela=function(a){linha=$("tr#"+a.id),linha.children("td:nth-child(3)").html(a.nome)},btnEditarUsuClick=function(){var a=$(this),e=a.parent().parent().parent(),r=parseInt(e.children("td:nth-child(2)").html());$.ajax({url:"/hermes/ajax/ajax_usuarios.php",type:"POST",data:{operacao:"infocompleta",id:r},dataType:"json",cache:!1,success:function(a){"ok"===a.status&&($('#form-usuarios input[name="operacao"]').val("alterar"),$('#form-usuarios input[name="nome"]').val(a.usuario.nome),$('#form-usuarios input[name="login"]').val(a.usuario.login),$('#form-usuarios input[name="senha"]').val(""),$('#form-usuarios input[name="confirma_senha"]').val(""),a.usuario.permissoes.envia_sms?$('#form-usuarios input[name="envia_sms"]').prop("checked",!0):$('#form-usuarios input[name="envia_sms"]').prop("checked",!1),a.usuario.permissoes.ver_logs?$('#form-usuarios input[name="ver_logs"]').prop("checked",!0):$('#form-usuarios input[name="ver_logs"]').prop("checked",!1),a.usuario.permissoes.controle_usuarios?$('#form-usuarios input[name="controle_usuarios"]').prop("checked",!0):$('#form-usuarios input[name="controle_usuarios"]').prop("checked",!1),$('#form-usuarios button[type="submit"]').html("Atualizar"),$("#form-usuarios").parent().children(":first-child").children().html("Atualizar dados do usuário..."),$("#form-usuarios").append($('<input type="hidden" name="id" value="'+r+'">')))}})},$("table tbody button .fa-pencil").parent().click(btnEditarUsuClick),desativarUsuario=function(){var a=$(this),e=a.parent().parent().parent(),r=parseInt(e.children("td:nth-child(2)").html());$.ajax({url:"/hermes/ajax/ajax_usuarios.php",type:"POST",data:{operacao:"desativar",id:r},dataType:"text",cache:!1,success:function(r){console.log(r),e.children("td:last-child").children("span").removeClass("label-success"),e.children("td:last-child").children("span").addClass("label-danger"),e.children("td:last-child").children("span").html("inativo"),a.children("i").removeClass("fa-remove"),a.children("i").addClass("fa-check"),a.unbind("click",desativarUsuario),a.bind("click",ativarUsuario),console.log(r.mensagem)},error:function(a,e,r){console.error("erro na requisição"),alert("Opa... Houve um erro na comunicação com o servidor! :(")}})},$("table tbody button .fa-remove").parent().click(desativarUsuario),ativarUsuario=function(){var a=$(this),e=a.parent().parent().parent(),r=parseInt(e.children("td:nth-child(2)").html());$.ajax({url:"/hermes/ajax/ajax_usuarios.php",type:"POST",data:{operacao:"ativar",id:r},dataType:"json",cache:!1,success:function(r){e.children("td:last-child").children("span").removeClass("label-danger"),e.children("td:last-child").children("span").addClass("label-success"),e.children("td:last-child").children("span").html("ativo"),a.children("i").removeClass("fa-check"),a.children("i").addClass("fa-remove"),a.unbind("click",ativarUsuario),a.bind("click",desativarUsuario)},error:function(a,e,r){}})},$("table tbody button .fa-check").parent().click(ativarUsuario),$("#form-usuarios").submit(function(){function r(){n.removeAttr("disabled"),n.val(s)}var t=this,i=$(t),n=$("#form-usuarios :submit"),s=n.val(),o=new FormData(t);return e||$.ajax({beforeSend:function(){e=!0,n.attr("disabled",!0),n.val("Enviando...")},url:i.attr("action"),type:i.attr("method"),data:o,dataType:"json",processData:!1,cache:!1,contentType:!1,success:function(t){"insere"===$('form input[name="operacao"]').val()?a(t.usuario):"alterar"===$('form input[name="operacao"]').val()&&atualizaDadosNaTabela(t.usuario),r(),resetarFormUsuario(),e=!1,i[0].reset(),alert(t.mensagem)},error:function(a,e,r){alert("Algo deu errado! Atualize a página e tente novamente!")}}),!1})});